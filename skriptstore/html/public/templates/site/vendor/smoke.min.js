!function(e,n){var t={smoketimeout:[],init:!1,zindex:1e3,i:0,bodyload:function(e){var i=n.createElement("div");i.setAttribute("id","smoke-out-"+e),i.className="smoke-base",i.style.zIndex=9999999,t.zindex++,n.body.appendChild(i)},newdialog:function(){var n=(new Date).getTime();return n=Math.random(1,99)+n,t.init?t.bodyload(n):t.listen(e,"load",function(){t.bodyload(n)}),n},forceload:function(){},build:function(n,i){t.i++,i.stack=t.i,n=n.replace(/\n/g,"<br />"),n=n.replace(/\r/g,"<br />");var o,a="",l="OK",c="Cancel",d="",u="";"prompt"===i.type&&(a='<div class="dialog-prompt"><input id="dialog-input-'+i.newid+'" type="text" '+(i.params.value?'value="'+i.params.value+'"':"")+" /></div>"),i.params.ok&&(l=i.params.ok),i.params.cancel&&(c=i.params.cancel),i.params.classname&&(d=i.params.classname),"signal"!==i.type&&(u='<div class="dialog-buttons">',"alert"===i.type?u+='<button id="alert-ok-'+i.newid+'">'+l+"</button>":"quiz"===i.type?(i.params.button_1&&(u+='<button class="quiz-button" id="'+i.type+"-ok1-"+i.newid+'">'+i.params.button_1+"</button>"),i.params.button_2&&(u+='<button class="quiz-button" id="'+i.type+"-ok2-"+i.newid+'">'+i.params.button_2+"</button>"),i.params.button_3&&(u+='<button class="quiz-button" id="'+i.type+"-ok3-"+i.newid+'">'+i.params.button_3+"</button>"),i.params.button_cancel&&(u+='<button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+i.params.button_cancel+"</button>")):("prompt"===i.type||"confirm"===i.type)&&(u+=i.params.reverseButtons?'<button id="'+i.type+"-ok-"+i.newid+'">'+l+'</button><button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+c+"</button>":'<button id="'+i.type+"-cancel-"+i.newid+'" class="cancel">'+c+'</button><button id="'+i.type+"-ok-"+i.newid+'">'+l+"</button>"),u+="</div>"),o='<div id="smoke-bg-'+i.newid+'" class="smokebg"></div><div class="dialog smoke '+d+'"><div class="dialog-inner">'+n+a+u+"</div></div>",t.init?t.finishbuild(n,i,o):t.listen(e,"load",function(){t.finishbuild(n,i,o)})},finishbuild:function(e,i,o){var a=n.getElementById("smoke-out-"+i.newid);for(a.className="smoke-base smoke-visible  smoke-"+i.type,a.innerHTML=o;""===a.innerHTML;)a.innerHTML=o;switch(t.smoketimeout[i.newid]&&clearTimeout(t.smoketimeout[i.newid]),t.listen(n.getElementById("smoke-bg-"+i.newid),"click",function(){t.destroy(i.type,i.newid),"prompt"===i.type||"confirm"===i.type||"quiz"===i.type?i.callback(!1):"alert"===i.type&&"undefined"!=typeof i.callback&&i.callback()}),i.type){case"alert":t.finishbuildAlert(e,i,o);break;case"confirm":t.finishbuildConfirm(e,i,o);break;case"quiz":t.finishbuildQuiz(e,i,o);break;case"prompt":t.finishbuildPrompt(e,i,o);break;case"signal":t.finishbuildSignal(e,i,o);break;default:throw"Unknown type: "+i.type}},finishbuildAlert:function(i,o,a){t.listen(n.getElementById("alert-ok-"+o.newid),"click",function(){t.destroy(o.type,o.newid),"undefined"!=typeof o.callback&&o.callback()}),n.onkeyup=function(n){n||(n=e.event),(13===n.keyCode||32===n.keyCode||27===n.keyCode)&&(t.destroy(o.type,o.newid),"undefined"!=typeof o.callback&&o.callback())}},finishbuildConfirm:function(i,o,a){t.listen(n.getElementById("confirm-cancel-"+o.newid),"click",function(){t.destroy(o.type,o.newid),o.callback(!1)}),t.listen(n.getElementById("confirm-ok-"+o.newid),"click",function(){t.destroy(o.type,o.newid),o.callback(!0)}),n.onkeyup=function(n){n||(n=e.event),13===n.keyCode||32===n.keyCode?(t.destroy(o.type,o.newid),o.callback(!0)):27===n.keyCode&&(t.destroy(o.type,o.newid),o.callback(!1))}},finishbuildQuiz:function(i,o,a){var l,c,d;t.listen(n.getElementById("quiz-cancel-"+o.newid),"click",function(){t.destroy(o.type,o.newid),o.callback(!1)}),(l=n.getElementById("quiz-ok1-"+o.newid))&&t.listen(l,"click",function(){t.destroy(o.type,o.newid),o.callback(l.innerHTML)}),(c=n.getElementById("quiz-ok2-"+o.newid))&&t.listen(c,"click",function(){t.destroy(o.type,o.newid),o.callback(c.innerHTML)}),(d=n.getElementById("quiz-ok3-"+o.newid))&&t.listen(d,"click",function(){t.destroy(o.type,o.newid),o.callback(d.innerHTML)}),n.onkeyup=function(n){n||(n=e.event),27===n.keyCode&&(t.destroy(o.type,o.newid),o.callback(!1))}},finishbuildPrompt:function(i,o,a){var l=n.getElementById("dialog-input-"+o.newid);setTimeout(function(){l.focus(),l.select()},100),t.listen(n.getElementById("prompt-cancel-"+o.newid),"click",function(){t.destroy(o.type,o.newid),o.callback(!1)}),t.listen(n.getElementById("prompt-ok-"+o.newid),"click",function(){t.destroy(o.type,o.newid),o.callback(l.value)}),n.onkeyup=function(n){n||(n=e.event),13===n.keyCode?(t.destroy(o.type,o.newid),o.callback(l.value)):27===n.keyCode&&(t.destroy(o.type,o.newid),o.callback(!1))}},finishbuildSignal:function(i,o,a){n.onkeyup=function(n){n||(n=e.event),27===n.keyCode&&(t.destroy(o.type,o.newid),"undefined"!=typeof o.callback&&o.callback())},t.smoketimeout[o.newid]=setTimeout(function(){t.destroy(o.type,o.newid),"undefined"!=typeof o.callback&&o.callback()},o.timeout)},destroy:function(e,i){var o=n.getElementById("smoke-out-"+i);if("quiz"!==e)var a=n.getElementById(e+"-ok-"+i);var l=n.getElementById(e+"-cancel-"+i);if(o.className="smoke-base",a&&(t.stoplistening(a,"click",function(){}),n.onkeyup=null),"quiz"===e)for(var c=n.getElementsByClassName("quiz-button"),d=0;d<c.length;d++)t.stoplistening(c[d],"click",function(){}),n.onkeyup=null;l&&t.stoplistening(l,"click",function(){}),t.i=0,o.innerHTML=""},alert:function(e,n,i){"object"!=typeof i&&(i=!1);var o=t.newdialog();t.build(e,{type:"alert",callback:n,params:i,newid:o})},signal:function(e,n,i){"object"!=typeof i&&(i=!1);var o=5e3;"undefined"!==i.duration&&(o=i.duration);var a=t.newdialog();t.build(e,{type:"signal",callback:n,timeout:o,params:i,newid:a})},confirm:function(e,n,i){"object"!=typeof i&&(i=!1);var o=t.newdialog();t.build(e,{type:"confirm",callback:n,params:i,newid:o})},quiz:function(e,n,i){"object"!=typeof i&&(i=!1);var o=t.newdialog();t.build(e,{type:"quiz",callback:n,params:i,newid:o})},prompt:function(e,n,i){"object"!=typeof i&&(i=!1);var o=t.newdialog();return t.build(e,{type:"prompt",callback:n,params:i,newid:o})},listen:function(e,n,t){return e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent?e.attachEvent("on"+n,t):!1},stoplistening:function(e,n,t){return e.removeEventListener?e.removeEventListener(n,t,!1):e.detachEvent?e.detachEvent("on"+n,t):!1}};t.init=!0,"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define("smoke",[],function(){return t}):this.smoke=t}(window,document);